{% extends 'base.html' %}

{% block content %}
  <h2>SAAHride App</h2>
  <hr>
  <h3>Request a Ride</h3>

  <form method="post">
    {% csrf_token %}

    <!-- Auto-filled Pickup Location (readonly) -->
    <label for="id_pickup_location">Your Current Location:</label>
    <input type="text" id="id_pickup_location" name="pickup_location" readonly required><br><br>

    <!-- Destination -->
    <label for="id_destination">Destination:</label>
    {{ form.destination }}<br><br>

    <!-- Ride Type -->
    <label for="id_ride_type">Ride Type:</label>
    {{ form.ride_type }}<br><br>

    <button type="submit">Book Ride</button>
  </form>

  <script>
    window.onload = function () {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          // Replace with your actual API key (which you already did)
          const apiKey = "63ac94ed87e14e45b54be12a6a2153fb";

          fetch(https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lon}&key=${apiKey})
            .then(response => response.json())
            .then(data => {
              const address = data.results[0].formatted;
              document.getElementById("id_pickup_location").value = address;
            })
            .catch(error => {
              console.error("Geocoding failed:", error);
              alert("Failed to detect address.");
            });
        }, function(error) {
          alert("Location access denied or unavailable.");
        });
      } else {
        alert("Geolocation is not supported by your browser.");
      }
    };
  </script>
{% endblock %}